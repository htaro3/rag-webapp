# RAG Webアプリケーション システム概要設計書

## 1. システムの全体像

### 1.1 システムの目的
このシステムは、文書をアップロードして検索・質問できるWebアプリケーションです。
主な特徴は以下の通りです：

- 文書をアップロードすると、自動的に検索可能な状態になります
- 文書の内容について、自然な日本語で質問ができます
- 質問に対して、文書の内容に基づいた回答を生成します
- 回答の根拠となる文書の該当箇所も表示します

### 1.2 システムの構成要素
システムは以下の4つの主要な部分で構成されています：

1. フロントエンド（Web画面）
   - ユーザーが操作する画面
   - 文書のアップロード、検索、質問の入力
   - 検索結果や回答の表示

2. バックエンド（サーバー）
   - フロントエンドからの要求を受け付け
   - 文書の処理や検索の実行
   - 質問への回答生成

3. ベクトルデータベース
   - 文書の内容を数値（ベクトル）に変換して保存
   - 高速な検索を実現

4. AIモデル（Gemini API）
   - 文書の内容を理解するためのAI
   - 質問への回答を生成するためのAI

## 2. 主要な機能と流れ

### 2.1 文書のアップロードと処理
1. ユーザーが文書をアップロード
2. システムが文書を以下のように処理：
   - 文書を適切な大きさの塊（チャンク）に分割
   - 各チャンクの内容をAIが理解しやすい数値（ベクトル）に変換
   - ベクトルと文書の内容をデータベースに保存
3. 処理が完了すると、文書が検索可能な状態になる

### 2.2 文書の検索
1. ユーザーが検索したい内容を入力
2. システムが以下の処理を実行：
   - 検索内容をベクトルに変換
   - データベースから類似度の高い文書を探す
   - 見つかった文書を類似度順に並べ替え
3. 検索結果を画面に表示
   - 文書の該当箇所
   - 類似度（マッチ度）のスコア
   - 文書のメタデータ（タイトル、日付など）

### 2.3 質問応答
1. ユーザーが質問を入力
2. システムが以下の処理を実行：
   - 質問内容をベクトルに変換
   - 関連する文書を検索
   - 見つかった文書の内容を基に回答を生成
3. 回答と根拠を画面に表示
   - AIが生成した回答
   - 回答の根拠となった文書の該当箇所
   - 関連度の高い順に複数の文書を表示

## 3. データの流れ

### 3.1 文書アップロード時の流れ
```
[ユーザー] → [フロントエンド] → [バックエンド] → [AIモデル] → [ベクトルDB]
   ↑                                                                    |
   └──────────────────────────────────────────────────────────────────┘
```

1. ユーザーが文書をアップロード
2. フロントエンドが文書をバックエンドに送信
3. バックエンドが文書を処理：
   - 文書を分割
   - AIモデルでベクトル化
   - ベクトルDBに保存
4. 処理状態をユーザーに通知

### 3.2 検索時の流れ
```
[ユーザー] → [フロントエンド] → [バックエンド] → [AIモデル] → [ベクトルDB]
   ↑                                                                    |
   └──────────────────────────────────────────────────────────────────┘
```

1. ユーザーが検索内容を入力
2. フロントエンドが検索内容をバックエンドに送信
3. バックエンドが検索を実行：
   - 検索内容をベクトル化
   - ベクトルDBから類似文書を検索
4. 検索結果をユーザーに表示

### 3.3 質問応答時の流れ
```
[ユーザー] → [フロントエンド] → [バックエンド] → [AIモデル] → [ベクトルDB]
   ↑                                                                    |
   └──────────────────────────────────────────────────────────────────┘
```

1. ユーザーが質問を入力
2. フロントエンドが質問をバックエンドに送信
3. バックエンドが処理を実行：
   - 質問をベクトル化
   - 関連文書を検索
   - AIモデルで回答を生成
4. 回答と根拠をユーザーに表示

## 4. システムの特徴

### 4.1 検索の特徴
- セマンティック検索：文書の意味を理解して検索
- ハイブリッド検索：意味の類似性とキーワードの両方を考慮
- 類似度スコア：検索結果の関連度を0-100%で表示

### 4.2 回答生成の特徴
- 文書に基づいた回答：AIが文書の内容を理解して回答
- 根拠の提示：回答の元となった文書の該当箇所を表示
- 複数文書の参照：複数の文書を組み合わせて回答を生成

### 4.3 パフォーマンスの特徴
- 高速な検索：ベクトルデータベースによる高速検索
- キャッシュ機能：よく使われる検索結果を保存
- バッチ処理：大量の文書を効率的に処理

## 5. 今後の拡張予定

### 5.1 機能の拡張
- ユーザー認証の追加
- 文書の分類機能
- 検索履歴の保存
- カスタムインデックスの設定

### 5.2 性能の改善
- 検索精度の向上
- 処理速度の改善
- 大規模文書への対応
- 並列処理の強化 